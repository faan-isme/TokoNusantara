{% extends 'base.html' %}

{% block title %}Profile - Toko Nusantara{% endblock %}
{% block style %}
<style>
    .profileimg {
        width: 10rem;
    }

    .desc {
        display: flex;
        flex-direction: row;
        flex-wrap: wrap;
        max-width: 1000px;
        min-width: 300px;
    }

    .wicon {
        width: 1rem;
    }

    .wket {
        width: 4rem;
    }

    .desprofile {
        display: flex;
        flex-direction: column;
        padding-top: 2rem;
        margin-left: 1rem;
    }

    .navbar a {
        float: left;
        display: block;
        color: #070707;
        text-align: center;
        padding: 14px 16px;
        text-decoration: none;
    }

    .active {
        color: green !important;
        border: none;
        border-bottom: 3px solid green;
        border-radius: 0;
        outline: none;
    }

    .myswitch {
        width: 100px;
        height: 50px;

    }

    @media (max-width: 767px) {
        .desprofile {
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .desc {
            justify-content: center;
        }
    }
</style>
{% endblock %}
{% block script %}
<script>
    {% if msg %}
    alert('{{msg}}')
    window.location.href = '/profile'
    {% endif %}
    $(document).ready(function () {

        // Initial setup
        toggleFields('Semua');

        // Handle navbar link click event
        $('.navbar a').click(function (e) {
            e.preventDefault();
            var userType = $(this).attr('id').replace('Link', ''); // Extract 'customer' or 'seller'
            toggleFields(userType);
        });

        // Function to toggle fields based on user type
        function toggleFields(userType) {
            // Update navbar active state
            $('.navbar a').removeClass('active');
            $('#' + userType + 'Link').addClass('active');

        }
    });
    function refresh() {
        $('#toserbaname').val("{{data['toserbaname']}}");
        $('#email').val("{{data['email']}}");
        $('#deskripsi').val("{{data['profile_info']}}");
        $('#alamat').val("{{data['alamat']}}");
        $('#foto').val("{{data['profile_pic']}}");
        $('#no_telp').val("{{data['no_telp']}}");
    }
    function count_char() {

        // Ambil nilai dari textarea
        var deskripsi = $("#deskripsi").val();
        let max = 50;
        // Hitung panjang karakter
        var charCount = max - deskripsi.length;
        // Update tampilan panjang karakter
        $("#charCount").text('Deskripsi (' + charCount + '/50)');
        //peringatan validasi
        if (!is_desc(deskripsi)) {
            $('#info-descripsi')
                .text('Maksimal 50 karakter,atau karakter khusus berikut (/@*.,:!@#$%)!')
                .removeClass('d-none');
            $("#deskripsi").focus();
            return;
        } else {
            $('#info-descripsi')
                .text('')
                .addClass('d-none');
        }

    }
    function is_desc(asValue) {
        var regExp = /^([A-Za-z0-9()\/@*.,:!@#$%\s]{0,50})?$/;
        return regExp.test(asValue);
    }

    function is_password(asValue) {
        var regExp = /^[0-9a-zA-Z!@#$%^&*]{8,20}$/;
        return regExp.test(asValue);
    }
    function is_telephone(asValue) {
        // karena optional
        // Nomor telepon minimal 0 digit, maksimal 15 digit 
        var regExp = /^\d{0,15}$/;
        return regExp.test(asValue);
    }
    function is_name(asValue) {
        // boleh huruf dan angka, minimal 3 char, maksimal 15 char, 
        var regExp = /^[a-zA-Z0-9_-]{3,20}$/;
        return regExp.test(asValue);
    }
    function is_email(asValue) {
        var regExp = /^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$/;
        return regExp.test(asValue);
    }
    function is_foto(asValue) {
        //hanya menerima jpg, jpeg dan png
        var regExp = /^.*\.(jpg|jpeg|png)$/i;
        // ukuran maksimal 2MB
        var maxFileSize = 2000000; // 2MB
        return regExp.test(asValue.name.toLowerCase()) && asValue.size <= maxFileSize;
    }
    function submitForm() {
        let password = $('#password').val()
        let newPassword = $('#newPassword').val()
        let toserbaname = $('#toserbaname').val()
        let email = $('#email').val()
        let deskripsi = $('#deskripsi').val()
        let no_telp = $('#no_telp').val()
        let foto = $('#foto')[0].files[0];

        if (toserbaname === '') {
            $('#info-name')
                .text('Nama toko tidak boleh kosong!')
                .removeClass('d-none');
            $("#toserbaname").focus();

            return;
        }
        if (!is_name(toserbaname)) {
            $('#info-name')
                .text('Hanya masukkan angka dan huruf, minimal 3 karakter Maksimal 20 karakter !')
                .removeClass('d-none');
            $("#tosebaname").focus();
            return;
        }
        if (email === '') {
            $('#info-email')
                .text('Email toko tidak boleh kosong!')
                .removeClass('d-none');
            $("#toserbaname").focus();
            return;
        }
        if (!is_email(email)) {
            $('#info-email')
                .text('Masukkan email')
                .removeClass('d-none');
            $("#no_telp").focus();
            return;
        }
        if (password && newPassword || password && !newPassword) {
            if (!is_password(newPassword) || !is_password(password)) {
                $('#info-password')
                    .text('Silakan masukkan 8-20 karakter  huruf, angka, atau karakter khusus berikut (!@#$%^&*)')
                    .removeClass('d-none');
                $("#tosebaname").focus();
                return;
            }
        }


        if (!is_telephone(no_telp)) {
            $('#info-no_telp')
                .text('Hanya masukkan angka, Maksimal 15 digit !')
                .removeClass('d-none');
            $("#no_telp").focus();
            return;
        }
        if (foto) {
            if (!is_foto(foto)) {
                $('#info-foto')
                    .text('Hanya menerima JPG, JPEG dan PNG, Maksimal 2MB !')
                    .removeClass('d-none');
                $("#foto").focus();
                return;
            }
        }
        if (!is_desc(deskripsi)) {
            $('#info-descripsi')
                .text('Maksimal 25 karakter,atau karakter khusus berikut (/@*.,:!@#$%)!')
                .removeClass('d-none');
            $("#deskripsi").focus();
            return;
        }


        // Mengambil referensi ke formulir
        // Melakukan pengiriman formulir secara manual
        $('#formEditProfile').submit();
    }

</script>
{% endblock %}

{% block navbar %}
<a href="/home" class="link-list ">Home</a>
<a href="/dashboard" class="link-list">Dashboard</a>
<a href="#" class="link-list active">Profile</a>
{% endblock %}

{% block konten %}
<div class="container-fluid" style="background-color: #ffc536ff;">
    <br>
    <div class="container-sm  d-flex  justify-content-center flex-wrap">
        <div class=" profileimg flex-warap flex-column d-flex align-items-center flex-center">
            <div class="my-3" style="height: 10rem; width:10rem; border-radius:50%; overflow:hidden">
                <img src="{{ url_for('static', filename=data['profile_pic_real']) }}" alt="" class="img-circle"
                    style="height: 100%;">

            </div>

            <h5>{{data['toserbaname']}}</h5>

            <div>
                <a href="mailto:{{data['email']}}" style="text-decoration: none;">{{data['email']}}</a>
            </div>
            <div class="mt-2">
                <button type="button" style="border: unset; border-radius:10px; background-color:unset"
                    data-bs-toggle="modal" data-bs-target="#editProfile" onclick="refresh()"><i
                        class="fa-solid fa-pen-to-square" style="color: #1d3a6d;"></i>Edit</button>
            </div>
        </div>


        <div class="desprofile ">
            <div class="desc">
                <div class="mx-1 wicon"><i class="fa-solid fa-shop" style="color: #000000;"></i></div>
                <div class="mx-1 wket">Produk</div>
                <div class="mx-1">:</div>
                <div class="mx-1">263</div>
            </div>
            <div class="desc">
                <div class="mx-1 wicon"><i class="fa-solid fa-location-dot" style="color: #ff0000;"></i></div>
                <div class="mx-1 wket">Alamat</div>
                <div class="mx-1">:</div>
                <div class="mx-1"><a href="{{data['alamat']}}" target="_blank">{{data['alamat']}}</a></div>
            </div>
            <div class="desc">
                <div class="mx-1 wicon"><i class="fa-brands fa-whatsapp" style="color: #1b9834;"></i></div>
                <div class="mx-1 wket">Telepon</div>
                <div class="mx-1">:</div>
                <div class="mx-1">{{data['no_telp']}}</div>
            </div>
            <div class="desc">
                <div class="mx-1 wicon"><i class="fa-solid fa-circle-info" style="color: #0c136e;"></i></div>
                <div class="mx-1 wket">Deskripsi</div>
                <div class="mx-1">:</div>
                <div class="mx-1">{{data['profile_info']}}</div>
            </div>
        </div>
        <div class="container d-flex justify-content-center">
            <div class="navbar">
                <a href="#" id="SemuaLink" class="myswitch active mx-2">Semua</a>
                <a href="#" id="SembakoLink" class="myswitch mx-2">Sembako</a>
                <a href="#" id="SabunLink" class="myswitch mx-2">Parabot</a>
                <a href="#" id="LainLink" class="myswitch mx-2">Lain - lain</a>
            </div>
        </div>

    </div>
</div>
<div class="container-lg mt-5">
    <div class="row row-cols-1 row-cols-md-4 g-10">
        <!-- card barang -->
        <div class="col mb-3">
            <div class="card h-100">
                <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAP8AAADFCAMAAACsN9QzAAAAMFBMVEXQ0NDw8PDX19fU1NTn5+fl5eXt7e3q6urY2Nju7u7Ozs7e3t7g4ODy8vLi4uLb29uNTQONAAAFDElEQVR4nO2d6YKqMAyFpaxeRN//ba+MIordkqbQmJyfQ1vznbZhaWFOJ9Gqjw7gYCm/bCm/bCm/bCm/bCm/bCm/bCm/bCm/bCm/bCm/bCm/bCm/bCm/bCm/bCm/bCm/bCm/bCm/bCm/bCm/bKXw12a4jeN4M4xNxIc+XJqummad++uNMKRdheT/V7d3+OqpuwXNQBvXXkLyj131qalqaQPbSSj+up2qL00dxzSAirmx4N8N6A11dPmF4b9a8WcD+I0ARMSjnX5Wy84AeMCmc3T/LHbnQTi/LffxzYHgeM3ZjX83YMwRZEaB+S+e7p9T4L8cUeYTmL/38lcTswkADbf247ObAFD+IcR/zRJmNkH5xxB/wysBQPn96Y9fAlR+mKSP/2D+a3+bX/r577R98LPlZ/YMAMzvuvl/quM1/OH8g7/7LzmCzCgwv/XZ39r9zC7/Eff/N08GYNf9mOdfVzd+w637Uc8/7Y9/59HPLPmfcPy1/RnA1LF7+odd/7CNgOnMcQkMN2HvJ4GtAyxXP/Drv0P/AV91zK57F+ET9q3pz3/L33f4nt15b1HS/ofb5dq21+vIceI/xe6ETSzlly3lly3lly3lly3lly3lly3lly3lly3lL1H7PU4skr/d72WSAvnnFeZpr5305fE/Ftj3MqA8/uf+gqnZ5deK439tr5h2yQGl8bdvq2p7GFAW/+fC8h7bKYri3+4t2iEJFsX/ta0gfw4oid+ysyy7AeXwWzeVZM8BxfC79hVmzgGl8Nt7P/8IKIXfiZ85BxTC3zrpZ2U0oAh+9+DPPgVK4Pdvqc5rQAn8gd5/GJDptwvgD/b+nwGZcsDh/HUTQZ9vChzNH0p9uQ04mD8eP5MBB/MD8PMkwWP5o1LfmwH0SfBIfsjgX0YAdby07ZkroD04fgYDSJszPSC+2BNfXgMoW5vfC4qPD9H7GQwgbKx+fBgpLj7M4H+K1AC6tpbvQkV1UAI+7Qgga8q8XoqLiC8Fn9YAqpZMD4kvCZ/UAKKG6g6ycJOIT2kATTv15ptw3vjSBj+xASTNmK8XYj3xUeDTGUDRiukB8dHgkxlA0IgN3x0fET6VAeltbOf+S7b4qHqfzIDkJtyfw7R8DpUSn8aA1Ba+U58nPlp8EgMSG7DPfUd81PgUBqTVd3wJwhEfOT6BAUnVnanPFh9971MYkFLb+yXgbXx58JMNSKjsn/uv+B5ngVz4qQbg68bhL/EFEsVhBqCrhuf+e3zZej/VAGxNU8UTTX3G3v/7AbwByIqxg38n4Q3A1fNd9R0itAGoaoX1/iysAZha9bmw3p+FNABRKeay5wDhDIDXGUqb+4tQBoCrFDj3F2H+/wq0Rh34/u2hQowAYIUiU98q+AiAlR/KTH2rwCMAVLzY1LcKagCkdKEnvk8BpwBkv0rZc38RzID4spA7vkMFMiC6aPGpbxXEgNiSjPBBBkQWZJH6VsUbEFeOzdxfFG1AVDFWg/+h2M8xx/AzxI8eARGFWOLHGhAuY3hc9nwryoBgEXapb1VMDgjxDyXf74cUYUCAnzV+zBTwH2ea+lYFDfAeNkeHn66QAb6jA9fM/65ADvDwM5/7i/wGuPl/BD8wBZyH/P/nmJV8BriO/EDqW+WZAg7+nxn8D7kNsPOzP+9v5TTAyv9z+O4cYPsr41setxwGWPkH84MaovklSfllS/llS/llS/llS/llS/llS/llS/llq/4Pyu5AznGi3bUAAAAASUVORK5CYII="
                    class="card-img-top" alt="...">
                <div class="card-body">
                    <h5 class="card-title">Nama Barang</h5>
                    <p class="card-text">Harga Barang</p>
                    <!-- tombol lihat -->
                    <div class="my-3 d-flex justify-content-center">
                        <button class="btn btn-warning " type="submit" style="width: 100%;">Lihat</button>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Modal -->
<div class="modal fade" id="editProfile" tabindex="-1" aria-labelledby="editProfile" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="titleModal">Edit Profile</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <form action="/profile/edit" method="post" enctype="multipart/form-data" id="formEditProfile">

                    <div class="mb-3">
                        <label for="toserbaname" class="form-label">Toserba name</label>
                        <input type="text" class="form-control" id="toserbaname" name="toserbaname"
                            value="{{data['toserbaname']}}">
                        <p id="info-name" class="text-danger d-none"></p>
                    </div>
                    <div class="mb-3">
                        <label for="email" class="form-label">Email address</label>
                        <input type="email" class="form-control" id="email" name="email" value="{{data['email']}}">
                        <p id="info-email" class="text-danger d-none"></p>
                    </div>
                    <div class="mb-3">
                        <label for="newPassword" class="form-label">Edit password</label>
                        <div class="d-flex">
                            <input type="password" class="form-control me-2" id="password" name="password"
                                placeholder="password">
                            <input type="password" class="form-control ms-2" id="newPassword" name="newPassword"
                                placeholder="new password">
                        </div>
                        <p id="info-password" class="text-danger d-none"></p>

                    </div>
                    <div class="mb-3">
                        <label for="no_telp" class="form-label">No Telepon/WA </label>
                        <input class="form-control" type="tel" id="no_telp" name="no_telp" value="{{data['no_telp']}}">
                        <p id="info-no_telp" class="text-danger d-none"></p>
                    </div>
                    <div class="mb-3">
                        <label for="alamat" class="form-label">Link google Map </label>
                        <input class="form-control" type="url" id="alamat" name="alamat" value="{{data['alamat']}}">
                    </div>
                    <div class="mb-3">
                        <label for="foto" class="form-label">Foto </label>
                        <input class="form-control" type="file" id="foto" name="foto" value="{{data['profile_pic']}}">
                        <p id="info-foto" class="text-danger d-none"></p>
                    </div>
                    <div class="mb-3">
                        <label for="deskripsi" class="form-label" id="charCount">Deskripsi </label>
                        <textarea class="form-control" id="deskripsi" rows="3" name="desc"
                            onkeyup="count_char()">{{data['profile_info']}}</textarea>
                        <p id="info-descripsi" class="text-danger d-none"></p>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Tutup</button>
                <button type="button" class="btn btn-primary" onclick="submitForm()">Simpan perubahan</button>
            </div>
        </div>
    </div>
</div>

{% endblock %}

