{% extends 'base.html' %}

{% block navbar %}
<a href="/home" class="link-list active">Home</a>
<a href="/dashboard" class="link-list">Dashboard</a>
<a href="/profile" class="link-list ">Profile</a>
{% endblock %}
{% block script %}
<script>
  function submitForm() {
    //buat validasi

    // Mengambil referensi ke formulir
    // Melakukan pengiriman formulir secara manual
    $('#formInputProduct').submit();
  }
  function reset() {
    $('#namaBarang').val('');
    $('#kategori').val('');
    $('#jumlah').val('');
    $('#harga').val('');
    $('#foto').val('');
    $('#deskripsi').val('');
  }

  function update(id){
    id = id.split('-');
    var jumlah = $('#quantityInput-'+id[1]).val();
    console.log(jumlah);
    $.ajax({
      type: "POST",
      url: "/updateJml",
      data: {
          jumlah: jumlah
      },
      success: function (response) {
          
          window.location.reload()
      }
  })
  }

  function addItem(id) {
    var card = $('#' + id);
    var table = $('#cart');
    var dataCart = [];
    var itemName = card.data('name');
    var ids = id.split('-')

    table.find('tr').each(function () {
      var cellData = $(this).find('td:eq(1)').text();
      dataCart.push(cellData);
      return dataCart;
    });

    console.log(dataCart);
    //cek data di cart
    if (dataCart.includes(itemName)) {
      editItem(ids[1]);
    } else {
      var itemPrice = parseFloat(card.data('price'));
      var jml = $('#quantityInput-' + ids[1]).val();
      var table = document.getElementById('cart').getElementsByTagName('tbody')[0];
      var nomor = table.rows.length + 1;
      var newRow = table.insertRow(table.rows.length);


      var cell1 = newRow.insertCell(0);
      var cell2 = newRow.insertCell(1);
      var cell3 = newRow.insertCell(2);
      var cell4 = newRow.insertCell(3);
      var cell5 = newRow.insertCell(4);
      var cell6 = newRow.insertCell(5);

      cell1.innerHTML = nomor;
      cell2.innerHTML = itemName;
      cell3.innerHTML = 'Rp ' + itemPrice.toFixed(2);
      cell4.innerHTML = '<input type="number" id="edit-' + ids[1] + '" style="width:30px; border:unset" min="1" value="' + jml + '" onchange="updateTotal(this)">';
      cell5.innerHTML = 'Rp ' + itemPrice.toFixed(2);
      cell6.innerHTML = '<button class="edit-btn" onclick="editItem(' + ids[1] + ')">Edit</button> <button class="delete-btn" onclick="deleteItem(this)">Hapus</button>';

      updateTotal();
      showCart();
    };


    hideInputJml(id);
  }




  function updateTotal(input) {
    var rows = document.getElementById('cart').getElementsByTagName('tbody')[0].getElementsByTagName('tr');
    var total = 0;

    for (var i = 0; i < rows.length; i++) {
      var price = parseFloat(rows[i].cells[2].innerText.replace('Rp ', ''));
      var quantity = parseInt(rows[i].cells[3].getElementsByTagName('input')[0].value);
      var subtotal = price * quantity;
      rows[i].cells[4].innerText = 'Rp ' + subtotal.toFixed(2);
      total += subtotal;
    }

    document.getElementById('total').innerText = 'Rp ' + total.toFixed(2);
  }

  function editItem(id) {
    $("#edit-" + id).focus();
  }

  function deleteItem(button) {
    var row = button.closest('tr');
    row.parentNode.removeChild(row);
    updateTotal();
    showCart();
  }


  function showCart() {
    var cartTable = $('#cart');
    var hasItems = cartTable.find('tbody tr').length > 0;
    if (hasItems) {
      cartTable.removeClass('d-none'); // Menghapus kelas 'd-none' jika ada item
    } else {
      cartTable.addClass('d-none'); // Menambahkan kelas 'd-none' jika tidak ada item
    }
  }
  function showInputJml(id) {
    id = id.split('-');
    if (id[0] === 'jual') {
      $('#inputjml-' + id[1]).removeClass('d-none');
      $('#batal-' + id[1]).removeClass('d-none');
      $('#jualCart-' + id[1]).removeClass('d-none');
      $('#tambah-' + id[1]).addClass('d-none');
      $('#jual-' + id[1]).addClass('d-none');
    } else {
      $('#inputjml-' + id[1]).removeClass('d-none');
      $('#batal-' + id[1]).removeClass('d-none');
      $('#update-' + id[1]).removeClass('d-none');
      $('#tambah-' + id[1]).addClass('d-none');
      $('#jual-' + id[1]).addClass('d-none');
    }

  }
  function hideInputJml(id) {

    id = id.split('-');
    // Update navbar active state
    $('#tambah-' + id[1]).removeClass('d-none');
    $('#jual-' + id[1]).removeClass('d-none');
    $('#batal-' + id[1]).addClass('d-none');
    $('#inputjml-' + id[1]).addClass('d-none');
    $('#jualCart-' + id[1]).addClass('d-none');
    $('#update-' + id[1]).addClass('d-none');
    $('#quantityInput-' + id[1]).val(1);
  }

  function increment(id) {
    id = id.split('-')
    var inputElement = $('#quantityInput-' + id[1]);
    var currentValue = parseInt(inputElement.val()) || 1;
    inputElement.val(currentValue + 1);
  }

  function decrement(id) {
    id = id.split('-')
    var inputElement = $('#quantityInput-' + id[1]);
    var currentValue = parseInt(inputElement.val()) || 1;
    if (currentValue > 1) {
      inputElement.val(currentValue - 1);
    }
  }

</script>
{% endblock %}

{% block style %}
<style>
  input[type="number"]::-webkit-inner-spin-button,
  input[type="number"]::-webkit-outer-spin-button {
    -webkit-appearance: none;
    margin: 0;
  }

  input[type="number"] {
    -moz-appearance: textfield;
    appearance: textfield;
  }
</style>
{% endblock %}

{% block konten %}
<div id="hero-carousel" class="carousel slide" data-bs-ride="carousel">
  <div class="carousel-indicators">
    <button type="button" data-bs-target="#hero-carousel" data-bs-slide-to="0" class="active" aria-current="true"
      aria-label="Slide 1"></button>
    <button type="button" data-bs-target="#hero-carousel" data-bs-slide-to="1" aria-label="Slide 2"></button>
    <button type="button" data-bs-target="#hero-carousel" data-bs-slide-to="2" aria-label="Slide 3"></button>
  </div>
  <div class="carousel-inner">
    <div class="carousel-item active c-item">
      <img
        src="https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcTmU-8_kFHcCrOoGxKy6osxgOk6Ecs_lE-Z3EKyxw34YB_WXjsv8NFRFPRysP-BeLyebEo&usqp=CAU"
        class="d-block w-100 c-img" alt="Slide 1">
      <div class="carousel-caption top-0 mt-5 d-none d-md-block">
        <h1 class="display-1 fw-bolder text-capitalize">TOKO NUSANTARA</h1>
      </div>
    </div>
    <div class="carousel-item c-item">
      <img
        src="https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcTmU-8_kFHcCrOoGxKy6osxgOk6Ecs_lE-Z3EKyxw34YB_WXjsv8NFRFPRysP-BeLyebEo&usqp=CAU"
        class="d-block w-100 c-img" alt="Slide 2">
      <div class="carousel-caption top-0 mt-5 d-none d-md-block">
        <h1 class="display-1 fw-bolder text-capitalize">Text Heading</h1>
      </div>
    </div>
    <div class="carousel-item c-item">
      <img
        src="https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcTmU-8_kFHcCrOoGxKy6osxgOk6Ecs_lE-Z3EKyxw34YB_WXjsv8NFRFPRysP-BeLyebEo&usqp=CAU"
        class="d-block w-100 c-img" alt="Slide 3">
      <div class="carousel-caption top-0 mt-5 d-none d-md-block">
        <h1 class="display-1 fw-bolder text-capitalize">Text Heading</h1>
      </div>
    </div>
  </div>
  <button class="carousel-control-prev" type="button" data-bs-target="#hero-carousel" data-bs-slide="prev">
    <span class="carousel-control-prev-icon" aria-hidden="true"></span>
    <span class="visually-hidden">Previous</span>
  </button>
  <button class="carousel-control-next" type="button" data-bs-target="#hero-carousel" data-bs-slide="next">
    <span class="carousel-control-next-icon" aria-hidden="true"></span>
    <span class="visually-hidden">Next</span>
  </button>
</div>


<div class="button mt-3">
  <div class="d-flex justify-content-around mb-8">
    <button class="btn btn-warning" type="button" data-bs-toggle="modal" data-bs-target="#inputProduct">Input
      Produk</button>
  </div>
</div>
<div class="container my-3">
  <!-- search -->
</div>
<div class=" container table-responsive-md">
  <table class="table d-none" id="cart">
    <thead>
      <tr>
        <th scope="col">No</th>
        <th scope="col">Nama Produk</th>
        <th scope="col">Harga Satuan</th>
        <th scope="col">Jumlah</th>
        <th scope="col">Sub Total</th>
        <th scope="col">Aksi</th>

      </tr>
    </thead>
    <tbody class="table-group-divider">


    </tbody>
    <tfoot>
      <tr>
        <td colspan="4"><strong>Total</strong></td>
        <td id="total">Rp 0</td>
        <td></td>
      </tr>
    </tfoot>
  </table>
</div>

<!-- Modal -->
<div class="modal fade" id="inputProduct" tabindex="-1" aria-labelledby="inputProduct" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="title">Input Product</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <form action="/inputBarang" method="post" enctype="multipart/form-data" id="formInputProduct">

          <div class="mb-3">
            <label for="namaBarang" class="form-label">Nama Barang</label>
            <input type="text" class="form-control" id="namaBarang" name="namaBarang" required>
            <p id="info-name" class="text-danger d-none"></p>
          </div>
          <div class="mb-3">
            <label for="kategori" class="form-label">Kategori</label>
            <select class="form-select" id="kategori" aria-label="dropdown kategori" required>
              <option selected>--pilih--</option>
              <option value="Elektronik">Elektronik</option>
              <option value="Kebersihan">Kebersihan</option>
              <option value="Kecantikan">Kecantikan</option>
              <option value="Makanan">Makanan</option>
              <option value="Minuman">Minuman</option>
              <option value="Sembako">Sembako</option>
              <option value="Perabotan">Perabotan</option>
            </select>
          </div>
          <div class="mb-3">
            <div class="d-flex justify-content-between">
              <div class="me-2">
                <label for="jumlah" class="form-label">jumlah</label>
                <input type="number" class="form-control " id="jumlah" name="jumlah" required>
              </div>
              <div class="ms-2">
                <label for="harga" class="form-label">harga</label>
                <input type="number" class="form-control " id="harga" name="harga" required>
              </div>
            </div>
            <p id="info-harga" class="text-danger d-none"></p>
            <p id="info-jumlah" class="text-danger d-none"></p>
          </div>


          <div class="mb-3 ">
            <label for="foto" class="form-label">Foto </label>
            <input class="form-control" type="file" id="foto" name="foto" required>
            <p id="info-foto" class="text-danger d-none"></p>
          </div>
          <div class="mb-3">
            <label for="deskripsi" class="form-label">Deskripsi (maks 25 karakter)</label>
            <textarea class="form-control" id="deskripsi" rows="3" name="desc"></textarea>
          </div>
        </form>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal" onclick="reset()">Tutup</button>
        <button type="button" class="btn btn-primary" onclick="submitForm()">Simpan perubahan</button>
      </div>
    </div>
  </div>
</div>
<!-- card container -->
<div class="container-lg mt-5">
  <div class="row row-cols-1 row-cols-md-4 g-10" id="cardcontainer">
    <!-- setiap id tambahkan nomer berdasarkan iterasi -->
    <!-- card barang -->
    {% for item in data %}
    <div class="col mb-3">
      <div class="card h-100">
        <img
          src="{{url_for('static', filename=item['foto'])}}"
          class="card-img-top" alt="...">
        <div class="card-body">
          <h5 class="card-title">{{item['nama']}}</h5>
          <p class="card-text">Rp {{item['harga']}}</p>
          <div class="d-flex justify-content-center">
            <p>{{item['Jumlah']}}pcs</p>
          </div>
          <!-- input jml -->
          <div class="mb-2 d-flex justify-content-center d-none" id="inputjml-{{ loop.index }}">
            <div class="border">
              <button class="border border-0" id="dec-{{ loop.index }}" style="width: 30px;" onclick="decrement(this.id)">-</button>
              <input class="text-center border border-0" type="number" id="quantityInput-{{ loop.index }}" value="1">
              <button class="border border-0" id="inc-{{ loop.index }}" style="width: 30px;" onclick="increment(this.id)">+</button>
            </div>
          </div>

          <!-- tombol lihat -->
          <div class="d-flex justify-content-around mb-2">
            <button class="btn btn-secondary" id="jual-{{ loop.index }}" onclick="showInputJml(this.id)"
              style="width:100px">Jual</button>
            <button class="btn btn-secondary d-none" id="jualCart-{{ loop.index }}" data-name="{{item['nama']}}" data-price="{{item['harga']}}"
              onclick="addItem(this.id)" style="width:100px">Jual</button>
            <button class="btn btn-secondary" id="tambah-{{ loop.index }}" style="width:100px"
              onclick="showInputJml(this.id)">Tambah</button>
            <button class="btn btn-secondary d-none" id="update-{{ loop.index }}" style="width:100px d-none"
              onclick="update(this.id)">Update</button>
            <button class="btn btn-secondary d-none" id="batal-{{ loop.index }}" onclick="hideInputJml(this.id)"
              style="width:100px">Batal</button>
          </div>
        </div>
      </div>
    </div>
    {% endfor %}
    <div class="col mb-3">
      <div class="card h-100">
        <img
          src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAP8AAADFCAMAAACsN9QzAAAAMFBMVEXQ0NDw8PDX19fU1NTn5+fl5eXt7e3q6urY2Nju7u7Ozs7e3t7g4ODy8vLi4uLb29uNTQONAAAFDElEQVR4nO2d6YKqMAyFpaxeRN//ba+MIordkqbQmJyfQ1vznbZhaWFOJ9Gqjw7gYCm/bCm/bCm/bCm/bCm/bCm/bCm/bCm/bCm/bCm/bCm/bCm/bCm/bCm/bCm/bCm/bCm/bCm/bCm/bCm/bKXw12a4jeN4M4xNxIc+XJqummad++uNMKRdheT/V7d3+OqpuwXNQBvXXkLyj131qalqaQPbSSj+up2qL00dxzSAirmx4N8N6A11dPmF4b9a8WcD+I0ARMSjnX5Wy84AeMCmc3T/LHbnQTi/LffxzYHgeM3ZjX83YMwRZEaB+S+e7p9T4L8cUeYTmL/38lcTswkADbf247ObAFD+IcR/zRJmNkH5xxB/wysBQPn96Y9fAlR+mKSP/2D+a3+bX/r577R98LPlZ/YMAMzvuvl/quM1/OH8g7/7LzmCzCgwv/XZ39r9zC7/Eff/N08GYNf9mOdfVzd+w637Uc8/7Y9/59HPLPmfcPy1/RnA1LF7+odd/7CNgOnMcQkMN2HvJ4GtAyxXP/Drv0P/AV91zK57F+ET9q3pz3/L33f4nt15b1HS/ofb5dq21+vIceI/xe6ETSzlly3lly3lly3lly3lly3lly3lly3lly3lL1H7PU4skr/d72WSAvnnFeZpr5305fE/Ftj3MqA8/uf+gqnZ5deK439tr5h2yQGl8bdvq2p7GFAW/+fC8h7bKYri3+4t2iEJFsX/ta0gfw4oid+ysyy7AeXwWzeVZM8BxfC79hVmzgGl8Nt7P/8IKIXfiZ85BxTC3zrpZ2U0oAh+9+DPPgVK4Pdvqc5rQAn8gd5/GJDptwvgD/b+nwGZcsDh/HUTQZ9vChzNH0p9uQ04mD8eP5MBB/MD8PMkwWP5o1LfmwH0SfBIfsjgX0YAdby07ZkroD04fgYDSJszPSC+2BNfXgMoW5vfC4qPD9H7GQwgbKx+fBgpLj7M4H+K1AC6tpbvQkV1UAI+7Qgga8q8XoqLiC8Fn9YAqpZMD4kvCZ/UAKKG6g6ycJOIT2kATTv15ptw3vjSBj+xASTNmK8XYj3xUeDTGUDRiukB8dHgkxlA0IgN3x0fET6VAeltbOf+S7b4qHqfzIDkJtyfw7R8DpUSn8aA1Ba+U58nPlp8EgMSG7DPfUd81PgUBqTVd3wJwhEfOT6BAUnVnanPFh9971MYkFLb+yXgbXx58JMNSKjsn/uv+B5ngVz4qQbg68bhL/EFEsVhBqCrhuf+e3zZej/VAGxNU8UTTX3G3v/7AbwByIqxg38n4Q3A1fNd9R0itAGoaoX1/iysAZha9bmw3p+FNABRKeay5wDhDIDXGUqb+4tQBoCrFDj3F2H+/wq0Rh34/u2hQowAYIUiU98q+AiAlR/KTH2rwCMAVLzY1LcKagCkdKEnvk8BpwBkv0rZc38RzID4spA7vkMFMiC6aPGpbxXEgNiSjPBBBkQWZJH6VsUbEFeOzdxfFG1AVDFWg/+h2M8xx/AzxI8eARGFWOLHGhAuY3hc9nwryoBgEXapb1VMDgjxDyXf74cUYUCAnzV+zBTwH2ea+lYFDfAeNkeHn66QAb6jA9fM/65ADvDwM5/7i/wGuPl/BD8wBZyH/P/nmJV8BriO/EDqW+WZAg7+nxn8D7kNsPOzP+9v5TTAyv9z+O4cYPsr41setxwGWPkH84MaovklSfllS/llS/llS/llS/llS/llS/llS/llq/4Pyu5AznGi3bUAAAAASUVORK5CYII="
          class="card-img-top" alt="...">
        <div class="card-body">
          <h5 class="card-title">Mie Goreng</h5>
          <p class="card-text">Rp 5.000</p>
          <div class="d-flex justify-content-center">
            <p>100pcs</p>
          </div>
          <!-- input jml -->
          <div class="mb-2 d-flex justify-content-center d-none" id="inputjml-1">
            <div class="border">
              <button class="border border-0" id="dec-1" style="width: 30px;" onclick="decrement(this.id)">-</button>
              <input class="text-center border border-0" type="number" id="quantityInput-1" value="1">
              <button class="border border-0" id="inc-1" style="width: 30px;" onclick="increment(this.id)">+</button>
            </div>
          </div>

          <!-- tombol lihat -->
          <div class="d-flex justify-content-around mb-2">
            <button class="btn btn-secondary" id="jual-1" onclick="showInputJml(this.id)"
              style="width:100px">Jual</button>
            <button class="btn btn-secondary d-none" id="jualCart-1" data-name="Mie Goreng" data-price="5000"
              onclick="addItem(this.id)" style="width:100px">Jual</button>
            <button class="btn btn-secondary" id="tambah-1" style="width:100px"
              onclick="showInputJml(this.id)">Tambah</button>
            <button class="btn btn-secondary d-none" id="update-1" style="width:100px d-none"
              onclick="update(this.id)" >Update</button>
            <button class="btn btn-secondary d-none" id="batal-1" onclick="hideInputJml(this.id)"
              style="width:100px">Batal</button>
          </div>
        </div>
      </div>
    </div>


  </div>
</div>
{% endblock %}